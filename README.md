# GDK-Framework
Плагин представляет собой модульную систему основанную на GAS для упрощения разработки игровых проектов с использованием модульной архетектуры на Unreal Engine, также кроме GAS используются решения для игровых режимов и разнообразных геймплейных задач.

**Расшифровка аббривиатур:**
- **ASC** - Ability System Component
- **GA** - Gameplay Ability
- **GE** - Gameplay Effect
- **GT** - Gameplay Tags

## Расширение [Gameplay Ability System](https://docs.unrealengine.com/4.26/en-US/InteractiveExperiences/GameplayAbilitySystem/)
GAS полностью настроен и готов к использованию в blueprints и не требует дополнительных расширений на уровне C++. Инициализация системы происходит во время загркузки Asset Manager.
#### Ability System Component:
- В качестве базового класса для ASC теперь используется `UMGDKAbilitySystemComponent`.
- **Granted Abilities** - Список игровых способностей которые предоставляются при инициализации ASC.
- **Granted Attributes** - Список наборов атрибутов которые будут предоставляться при инициализации ASC с таблицей метаданных для атрибутов.
- **Granted Effects** - Список GE которые будут применяться при инициализации ASC (обычно при начале игры).
- Автоматическая привязка способностей к **Enhanced Input** системе.
- Дополнительные делегаты для отслеживания состояний ASC:
  - **On Attribute Change** - вызывается при изменении зарегистрированных атрибутов.
  - **On Ability Activated/Ended/Failed** - вызывается при активации/завершении/ошибки способностей.
  - **On Gameplay Effect Added/Removed/Stack Change/Time Change** - вызывается при добавлении/удалении/изменении стаков/изменении времени в GE.
  - **On Cooldown Start/Changed/End** - вызывается при старте/изменении/завершении кулдауна для конкретной способности.

#### Gameply Ability:
- **Effect Container Map** - карта с GE привязанных к GT, используется для автовоспроизведения GE при срабатывании соответствующих GT из данной карты.
- **Activate on Granted** - позволяет автоматически воспроизвести способность при регистрации в ASC.
- **Remove Ability on End** - если значение true то данная способность автоматически удалится из ASC после завершения.
- **Apply Effect Container** - функция для применения GE привязанных к GT из переменной **Effect Container Map**.

#### AttributeSet:
- Упрощенная система создания дополнительных атрибутов с поддержкой репликации через кастомное меню редактора (**GDK Framework->New C++ AttributeSet Class**).
- В качестве базового класса для атрибутов используется `UGDKAttributeSetBase`.
- В классе `UGDKAttributeSet` присутствуют базовые атрибуты, такие как **Health**, **Max Health**, **Stamina**, **Max Stamina**, **Mana**, **Max Mana**, **Damage**.

#### Target Type:
- Для простоты настройки определения таргетов способности, класс `UGDKTargetType` может быть переопределён в блупринтах. Базовым расширением является захват множественных целей для одной способности.
- **Target Type Use Owner** - определяет владельца способности как цель.
- **Target Type Use Event Data** - извлекает цель из Event Data при вызове в способности.

#### Ability Input Binding:
- Класс `UMGDKAbilityInputBindingComponent` является наследником `UMGDKPlayerControlsComponent` и используется только в `APawn` классах и его наследниках. 
- **Ability Input Binding Component** ключевой компонент для взаимодействия с **Enhanced Input**. Включает в себя функционал для привязки инпутов к способностям при регистрации. **Input Mapping Context**. Привязка к базовым, модульным и предметным способностям происходит автоматически.

#### Async Tasks:
- **Play Montage Wait For Event** (используется только в GA) - объединяет **Play Montage And Wait** и **Wait For Event** в одну задачу, так что вы можете дождаться нескольких типов активаций тегов при воспроизведении анимации.
- **Server Wait For Client Target Data**  (используется только в GA) - сервер ожидает обновления **Target Data** на клиенте владеющего способностью. Используется для асинхронной обработки полученных таргетов на клиенте и сервере.
- **Attribute Changed** - отслеживает изменение атрибутов указанных на входе у определенного ASC.
- **Gameplay Tag Added Removed** - отслеживает добавление и удаление GT в ASC.

## Модульный Геймплей
Данная модульная архитектура подразумевает использование автоматизированных компонентов и разделение гейплея на заменяемые модули с помощью плагина [**Game Features** и **Gameplay Modular**](https://docs.unrealengine.com/5.0/en-US/GameplayFeatures/GameFeaturesAndModularGameplay/). Данная архитектура подразумевает использование заготовленных модульных классов на замену базовых, эти классы расширены и заточены на использование модульного функционала, но они так же могут использоваться вне модульной системы:
- `AModularAIController`
- `AModularCharacter`
- `AModularGameModeBase`
- `AModularGameStateBase`
- `AModularPawn`
- `AModularPlayerController`
- `AModularPlayerState`
- `AModularPlayerStateCharacter` (это модульный `ACharacter`, примечателен тем что использует ASC созданный в **Player State**)

#### Game Features:
Расширение классов `UGameFeaturesProjectPolicies` и `UGameFeatureStateChangeObserver` позволило автоматизировать процесс создания и обнаружение модулей. При первом запуске проекта с подключенным плагином, система предложит исправить базовый класс `UGameFeaturesProjectPolicies` на кастомный и добавить поиск модулей в **Asset Manager** что позволит автоматически обнаруживать и загружать модульные плагины геймплея. Для создания нового модуля достаточно пары кликов (**GDK Framework->New Game Feature Plugin**).

###### Actions:
- **Add Abilities** - позволяет добавлять GA (с возможностью привязки к **Input Action**) и **Attribute Set** с методанными к любому классу наследуемого от Actor.
- **Add Anim Layers** - позволяет добавлять **Anim Instance** (который должен реализовывать интерфейс **Anim Layer**) к любому классу наследуемого от Actor.
- **Add Input Mapping** - позволяет добавлять **Input Mapping Context** что бы обеспечить поддержку инпутов в любом классе наследуемого от Actor.
- **Add Components** - позволяет добавлять любой компонент в любой класс наследуемый от Actor.

## Игровые режимы:
Указанные ниже компоненты используются исключительно в **Game State** и их взаимодействие друг с другом настраивается через ивенты.
- **Match State Component** - имеет 3 состояния матча: **Pre Game**, **In Game**, **Post Game**. Используется для контроля матча.
- **Match Timer Component** - используется для отслеживания времени матча, переменная `bEndMatchOnFinished` означает завершать ли матч, если время матча истекло.
- **Player Counting Component** - контролирует и отслеживает количество игроков в матче.
- **Player Publisher Component** - используется для определения сетевого состояния игрока: **Connected**, **In Game**, **Finished**, **Disconnected**. На основе текущего состояния происходит дальнейшее взаимодействие с игроком в остальный компонентах игрового режима.
- **Spawner Provider Component** - контролирует и обрабатывает запросы на спавн/респавн игрока.

## Система инвентаря:
Инвентарь имеет ряд особенностей но строится всё на той же модульной системе, из особенностей инвентаря можно выделить следующее:

- Взаимодействие с GAS и GT.
- Распределение функционала на отдельные подсистемные компоненты.
- Оптимизация и распределение сетевой нагрузки.

#### Item Data Asset:
Базовый класс предметов `UMGDKItemDataAsset` наследуется от `UPrimaryDataAsset` и имеет ряд важных особенностей взаимодействующих с инвентарём и геймплеем:
- **Unique Tag** - содержит уникальный тег предмета для его идентификации. 
- **Type Tags** - определяет к каким типам относится данный предмет.
- **Use Conditions** - содержит условия при которых предмет может быть использован.
- **Max Stack** - определяет максимальное количество предметов, если значение <= 1 то предмет будет считаться бесконечным (например: оружие или экипировка).
- **Weight** (если инвентарь использует ограничение по весу предметов) - определяет вес 1-й единици данного пердмета.
- **Granted Abilities** - содержит список GA которые будут зарегестрированы в ASC при использовании предмета.
- **Granted Effects** - содержит список GE которые будут применены на владельца при использовании предмета.
- **Metadata** - позволяет добавить пользовательские данные любого формата в предмет.

#### Inventory Component:
Инвентарь представляет собой массив слотов, для предметов, структура которого содержит переменные `Item Data` - текущий предмет в слоте, `Stacks` - текущее количество данного предмета. Рекомендуемое расположение инвентаря в `Player Controller` для правильной сетевой нагрузки. Все функции инвентаря должны воспроизводиться на клиенте **ИЛИ** сервере, **одновременное воспроизведение на клиенте И сервере приведёт к повторному добавлению предмета в инвентарь**. Для взаимодействия с инвентарём используется набор функционала:
- **Add Item To Inventory** - добавляет предметы в инвентарь. На вход подаются предмет класса `UMGDKItemDataAsset` и его кол-во.
- **Activation Item** - позволяет использовать предмет, если он соответствует всем условиям для успешного воспроизведения. На вход подаётся **Item ID** (это индекс слота в массиве **Inventory Items**) который мы хотим активировать.
- **Deactivation Item** - удаляет все GA, GE и GT предмета у владельца (исключение составляют временные GE, так как они сами удалятся по истечению установленного в них времени).
- **Swap Item In Inventory** - меняет местами слоты содержащие предметы или просто перемещает слот с предметом на другой индекс в массиве. На вход **Item ID** подаётся индекс слота с предметом который мы хотим перенести, на вход **To** мы подаём индекс слота куда мы хотим перенести.
- **Remove Item From Inventory** - удаляет определённое количество выбранного предмета из инвентаря, если предмет активен он так же деактивируется. На вход подаётся **Item ID** который мы хотим удалить. 
- **Drop Item From Inventory (in development)**

#### Equipment Component (in development)
